Управление проектом
===================

validate -- Проверить проект на синтаксис
-----------------------------------------

Для проверки синтаксиса проекта можно выполнить его перед отправкой, 
или использовать команду validate:

.. code-block:: bash    
 
    kraxcli -w . project validate

Это эквивалентно запуску krax.py из проекта с опцией --exports (эта опция приведет однократному
выполнению цикла программы). Предполагается что krax.py написан так что опцию --exports 
воспринимает как команду проверить вывести экспортируемые переменные.

vars -- Получить экспортируемые переменные
------------------------------------------

Команда vars выводит экспортируемые переменные проекта, по смыслу аналогично validate, но
уже с выводом результата. Результат копируется в буфер обмена (если возможно) и выводится 
на консоль:

.. code-block:: bash    

    kraxcli -w . project vars --format [CSV|PY|VAR_CONFIG]

Вывод может быть в различных форматах, также можно вывести экспортируемые переменные конкретного
источника данных (драйвер обмена). Примеры результатов:

CSV для импорта в ModbusTCP
::

    ADDITION_1_OUT;COILS;0;BOOL;BOOL;ReadWrite;10325476;
    RETARDER_2_DISABLE_1;COILS;23;BOOL;BOOL;ReadWrite;10325476;
    RETARDER_2_DISABLE_2;COILS;24;BOOL;BOOL;ReadWrite;10325476;
    RETARDER_3_DISABLE_1;COILS;25;BOOL;BOOL;ReadWrite;10325476;
    ...
    FILLER_2_SP;HOLDING_REGISTERS;8;REAL;REAL;ReadWrite;10325476;
    FILLER_3_SP;HOLDING_REGISTERS;10;REAL;REAL;ReadWrite;10325476;
    WATER_1_SP;HOLDING_REGISTERS;12;REAL;REAL;ReadWrite;10325476;

PY для использования в python-скриптах

.. code-block:: python

    #VSCode autocompleter блок.
    from typing import TYPE_CHECKING
    if TYPE_CHECKING:
        from collections import namedtuple
        HW = namedtuple('HW',['CEMENT_M_1','WATER_M_1','ADDITION_M_1','FILLERS_M_1','MIXER_I_1','DCEMENT_CLOSED_1','DWATER_CLOSED_1','DADDITION_CLOSED_1','CONVEYOR_ISON_1','AUGER_ISON_1','AUGER_ISON_2','WPUMP_ISON_1','APUMP_ISON_1','MIXER_ISON_1','MIXER_CLOSED_1','MIXER_OPENED_1','ELEVATOR_BELOW_1','ELEVATOR_ABOVE_1','WSENS_FAIL_1','DCEMENT_OPEN_1','DWATER_OPEN_1','DADDITION_OPEN_1','MIXER_OPEN_1','AERATOR_ON_1','AERATOR_ON_2','WATER_OPEN_1','FILLER_OPEN_1','FILLER_OPEN_2','FILLER_OPEN_3','FILLER_OPEN_4','FILLER_OPEN_5','FILLER_OPEN_6','DC_VIBRATOR_ON_1','CONVEYOR_ON_1','ELEVATOR_UP_1','ELEVATOR_DOWN_1','AUGER_ON_1','AUGER_ON_2','WPUMP_ON_1','APUMP_ON_1','MIXER_ON_1','DF_VIBRATOR_ON_1','VIBRATOR_ON_1','VIBRATOR_ON_2','VIBRATOR_ON_3','S_VIBRATOR_ON_1','S_VIBRATOR_ON_2','MIXER_OFF_1','HEARTBEAT_1','ADDITION_1_BUSY','ADDITION_1_CLOSED','ADDITION_1_DONE','ADDITION_1_E','ADDITION_1_ERR','ADDITION_1_GO','ADDITION_1_LOCK','ADDITION_1_M','ADDITION_1_MAX_FF','ADDITION_1_MAX_W','ADDITION_1_MIN_FF','ADDITION_1_MIN_W','ADDITION_1_OUT','ADDITION_1_SP','ADDITIONS_M_1_A','ADDITIONS_M_1_K','ADDITIONS_M_1_M','ADDITIONS_M_1_MA','ADDITIONS_M_1_RAW','ADDITIONS_M_1_SET','ADDITIONS_M_1_SHIFT','ADDITIONS_M_1_STEP','AERATOR_1_ENABLE','AERATOR_1_Q','AERATOR_1_T_OFF','AERATOR_1_T_ON','AERATOR_2_ENABLE','AERATOR_2_Q','AERATOR_2_T_OFF','AERATOR_2_T_ON','AUGER_1_BUSY','AUGER_1_CLOSED','AUGER_1_DONE','AUGER_1_E','AUGER_1_ERR','AUGER_1_GO','AUGER_1_LOCK','AUGER_1_M','AUGER_1_MAX_FF','AUGER_1_MAX_W','AUGER_1_MIN_FF','AUGER_1_MIN_W','AUGER_1_OUT','AUGER_1_SP','AUGER_2_BUSY','AUGER_2_CLOSED','AUGER_2_DONE','AUGER_2_E','AUGER_2_ERR','AUGER_2_GO','AUGER_2_LOCK','AUGER_2_M','AUGER_2_MAX_FF','AUGER_2_MAX_W','AUGER_2_MIN_FF','AUGER_2_MIN_W','AUGER_2_OUT','AUGER_2_SP','CEMENT_M_1_A','CEMENT_M_1_K','CEMENT_M_1_M','CEMENT_M_1_MA','CEMENT_M_1_RAW','CEMENT_M_1_SET','CEMENT_M_1_SHIFT','CEMENT_M_1_STEP','DADDITIONS_1_ACK','DADDITIONS_1_CLOSED','DADDITIONS_1_COMPENSATION','DADDITIONS_1_COUNT','DADDITIONS_1_FAIL','DADDITIONS_1_GO','DADDITIONS_1_IGNORE','DADDITIONS_1_LEAVE','DADDITIONS_1_LOCK','DADDITIONS_1_M','DADDITIONS_1_NACK','DADDITIONS_1_OUT','DADDITIONS_1_UNLOADT','DC_VIBRATOR_1_AUTO','DC_VIBRATOR_1_DOSATOR_ACK','DC_VIBRATOR_1_DOSATOR_CLOSED','DC_VIBRATOR_1_DOSATOR_COMPENSATION','DC_VIBRATOR_1_DOSATOR_COUNT','DC_VIBRATOR_1_DOSATOR_FAIL','DC_VIBRATOR_1_DOSATOR_GO','DC_VIBRATOR_1_DOSATOR_IGNORE','DC_VIBRATOR_1_DOSATOR_LEAVE','DC_VIBRATOR_1_DOSATOR_LOCK','DC_VIBRATOR_1_DOSATOR_M','DC_VIBRATOR_1_DOSATOR_NACK','DC_VIBRATOR_1_DOSATOR_OUT','DC_VIBRATOR_1_DOSATOR_UNLOADT','DC_VIBRATOR_1_IGNORE_DM','DC_VIBRATOR_1_Q','DC_VIBRATOR_1_WEIGHT_A','DC_VIBRATOR_1_WEIGHT_K','DC_VIBRATOR_1_WEIGHT_M','DC_VIBRATOR_1_WEIGHT_MA','DC_VIBRATOR_1_WEIGHT_RAW','DC_VIBRATOR_1_WEIGHT_SET','DC_VIBRATOR_1_WEIGHT_SHIFT','DC_VIBRATOR_1_WEIGHT_STEP','DCEMENT_1_ACK','DCEMENT_1_CLOSED','DCEMENT_1_COMPENSATION','DCEMENT_1_COUNT','DCEMENT_1_FAIL','DCEMENT_1_GO','DCEMENT_1_IGNORE','DCEMENT_1_LEAVE','DCEMENT_1_LOCK','DCEMENT_1_M','DCEMENT_1_NACK','DCEMENT_1_OUT','DCEMENT_1_UNLOADT','DF_VIBRATOR_1_AUTO','DF_VIBRATOR_1_DOSATOR_ACK','DF_VIBRATOR_1_DOSATOR_CLOSED','DF_VIBRATOR_1_DOSATOR_COMPENSATION','DF_VIBRATOR_1_DOSATOR_COUNT','DF_VIBRATOR_1_DOSATOR_FAIL','DF_VIBRATOR_1_DOSATOR_GO','DF_VIBRATOR_1_DOSATOR_IGNORE','DF_VIBRATOR_1_DOSATOR_LEAVE','DF_VIBRATOR_1_DOSATOR_LOCK','DF_VIBRATOR_1_DOSATOR_M','DF_VIBRATOR_1_DOSATOR_NACK','DF_VIBRATOR_1_DOSATOR_OUT','DF_VIBRATOR_1_DOSATOR_UNLOADT','DF_VIBRATOR_1_IGNORE_DM','DF_VIBRATOR_1_Q','DF_VIBRATOR_1_WEIGHT_A','DF_VIBRATOR_1_WEIGHT_K','DF_VIBRATOR_1_WEIGHT_M','DF_VIBRATOR_1_WEIGHT_MA','DF_VIBRATOR_1_WEIGHT_RAW','DF_VIBRATOR_1_WEIGHT_SET','DF_VIBRATOR_1_WEIGHT_SHIFT','DF_VIBRATOR_1_WEIGHT_STEP','DFILLERS_1_ACK','DFILLERS_1_CLOSED','DFILLERS_1_COMPENSATION','DFILLERS_1_COUNT','DFILLERS_1_FAIL','DFILLERS_1_GO','DFILLERS_1_IGNORE','DFILLERS_1_LEAVE','DFILLERS_1_LOCK','DFILLERS_1_M','DFILLERS_1_NACK','DFILLERS_1_OUT','DFILLERS_1_UNLOADT','DWATER_1_ACK','DWATER_1_CLOSED','DWATER_1_COMPENSATION','DWATER_1_COUNT','DWATER_1_FAIL','DWATER_1_GO','DWATER_1_IGNORE','DWATER_1_LEAVE','DWATER_1_LOCK','DWATER_1_M','DWATER_1_NACK','DWATER_1_OUT','DWATER_1_UNLOADT','ELEVATOR_1_ABOVE','ELEVATOR_1_ACK','ELEVATOR_1_BELOW','ELEVATOR_1_DOSATOR_ACK','ELEVATOR_1_DOSATOR_CLOSED','ELEVATOR_1_DOSATOR_COMPENSATION','ELEVATOR_1_DOSATOR_COUNT','ELEVATOR_1_DOSATOR_FAIL','ELEVATOR_1_DOSATOR_GO','ELEVATOR_1_DOSATOR_IGNORE','ELEVATOR_1_DOSATOR_LEAVE','ELEVATOR_1_DOSATOR_LOCK','ELEVATOR_1_DOSATOR_M','ELEVATOR_1_DOSATOR_NACK','ELEVATOR_1_DOSATOR_OUT','ELEVATOR_1_DOSATOR_UNLOADT','ELEVATOR_1_DOWN','ELEVATOR_1_FAULT','ELEVATOR_1_LOADED','ELEVATOR_1_MANUAL','ELEVATOR_1_MAXT','ELEVATOR_1_MOVET','ELEVATOR_1_PAUSET','ELEVATOR_1_STATE','ELEVATOR_1_UNLOADT','ELEVATOR_1_UP','ELEVATOR_1_WEIGHT','FACTORY_1__FACTORY__SEC_ENABLE','FACTORY_1__FACTORY__SEC_Q','FACTORY_1__FACTORY__SEC_T_OFF','FACTORY_1__FACTORY__SEC_T_ON','FACTORY_1_ACTIVATED','FACTORY_1_EMERGENCY','FACTORY_1_F_EMERGENCY_CLK','FACTORY_1_F_EMERGENCY_Q','FACTORY_1_F_MANUAL_CLK','FACTORY_1_F_MANUAL_Q','FACTORY_1_F_POWERACK_CLK','FACTORY_1_F_POWERACK_ET','FACTORY_1_F_POWERACK_PT','FACTORY_1_F_POWERACK_Q','FACTORY_1_HEARTBEAT','FACTORY_1_HOUR_CLK','FACTORY_1_HOUR_ET','FACTORY_1_HOUR_PT','FACTORY_1_HOUR_Q','FACTORY_1_LOAD','FACTORY_1_MANUAL','FACTORY_1_MOTO','FACTORY_1_OVER','FACTORY_1_POWERACK','FACTORY_1_POWERED','FACTORY_1_POWERFAIL','FACTORY_1_SCANTIME','FACTORY_1_USED','FILLER_1_BUSY','FILLER_1_CLOSED','FILLER_1_DONE','FILLER_1_E','FILLER_1_ERR','FILLER_1_GO','FILLER_1_LOCK','FILLER_1_M','FILLER_1_MAX_FF','FILLER_1_MAX_W','FILLER_1_MIN_FF','FILLER_1_MIN_W','FILLER_1_OUT','FILLER_1_SP','FILLER_2_BUSY','FILLER_2_CLOSED','FILLER_2_DONE','FILLER_2_E','FILLER_2_ERR','FILLER_2_GO','FILLER_2_LOCK','FILLER_2_M','FILLER_2_MAX_FF','FILLER_2_MAX_W','FILLER_2_MIN_FF','FILLER_2_MIN_W','FILLER_2_OUT','FILLER_2_SP','FILLER_3_BUSY','FILLER_3_CLOSED','FILLER_3_DONE','FILLER_3_E','FILLER_3_ERR','FILLER_3_GO','FILLER_3_LOCK','FILLER_3_M','FILLER_3_MAX_FF','FILLER_3_MAX_W','FILLER_3_MIN_FF','FILLER_3_MIN_W','FILLER_3_OUT','FILLER_3_SP','FILLERS_M_1_A','FILLERS_M_1_K','FILLERS_M_1_M','FILLERS_M_1_MA','FILLERS_M_1_RAW','FILLERS_M_1_SET','FILLERS_M_1_SHIFT','FILLERS_M_1_STEP','GATE_1_CLOSED','GATE_1_COUNT','GATE_1_DR','GATE_1_FORBID','GATE_1_LOCK','GATE_1_MANUAL','GATE_1_OPEN','GATE_1_OPENED','GATE_1_UNLOADING','IADDITIONS_M_1_LOADING','IADDITIONS_M_1_Q','IADDITIONS_M_1_UNLOADING','IAPUMP_1_ISON','IAPUMP_1_OFF','IAPUMP_1_ON','IAUGER_1_ISON','IAUGER_1_OFF','IAUGER_1_ON','IAUGER_2_ISON','IAUGER_2_OFF','IAUGER_2_ON','ICEMENT_M_1_LOADING','ICEMENT_M_1_Q','ICEMENT_M_1_UNLOADING','IDADDITION_1_CLOSED','IDADDITION_1_OPEN','IDADDITION_1_OPENED','IDCEMENT_1_CLOSED','IDCEMENT_1_OPEN','IDCEMENT_1_OPENED','IDFILLERS_1_ISON','IDFILLERS_1_OFF','IDFILLERS_1_ON','IDWATER_1_CLOSED','IDWATER_1_OPEN','IDWATER_1_OPENED','IELEVATOR_1_ABOVE','IELEVATOR_1_BELOW','IELEVATOR_1_DOWN','IELEVATOR_1_MIDDLE','IELEVATOR_1_UP','IFILLERS_M_1_LOADING','IFILLERS_M_1_Q','IFILLERS_M_1_UNLOADING','IGATE_1_CLOSE','IGATE_1_CLOSED','IGATE_1_MIDDLE','IGATE_1_OPEN','IGATE_1_OPENED','IMOTOR_1_ISON','IMOTOR_1_OFF','IMOTOR_1_ON','IWATER_M_1_LOADING','IWATER_M_1_Q','IWATER_M_1_UNLOADING','IWPUMP_1_ISON','IWPUMP_1_OFF','IWPUMP_1_ON','MANAGER_1_MIXER_ACK','MANAGER_1_MIXER_BREAKPOINT','MANAGER_1_MIXER_CLOCK','MANAGER_1_MIXER_COUNT','MANAGER_1_MIXER_EXPENSE_0','MANAGER_1_MIXER_EXPENSE_1','MANAGER_1_MIXER_EXPENSE_2','MANAGER_1_MIXER_EXPENSE_3','MANAGER_1_MIXER_EXPENSE_4','MANAGER_1_MIXER_EXPENSE_5','MANAGER_1_MIXER_EXPENSE_6','MANAGER_1_MIXER_F_GO_CLK','MANAGER_1_MIXER_F_GO_Q','MANAGER_1_MIXER_FORBID','MANAGER_1_MIXER_GATE_CLOSED','MANAGER_1_MIXER_GATE_COUNT','MANAGER_1_MIXER_GATE_DR','MANAGER_1_MIXER_GATE_FORBID','MANAGER_1_MIXER_GATE_LOCK','MANAGER_1_MIXER_GATE_MANUAL','MANAGER_1_MIXER_GATE_OPEN','MANAGER_1_MIXER_GATE_OPENED','MANAGER_1_MIXER_GATE_UNLOADING','MANAGER_1_MIXER_GO','MANAGER_1_MIXER_MIXT','MANAGER_1_MIXER_MOTOR_BELL','MANAGER_1_MIXER_MOTOR_ISON','MANAGER_1_MIXER_MOTOR_MANUAL','MANAGER_1_MIXER_MOTOR_OFF','MANAGER_1_MIXER_MOTOR_ON','MANAGER_1_MIXER_MOTOR_POWERED','MANAGER_1_MIXER_NACK','MANAGER_1_MIXER_QRESET','MANAGER_1_MIXER_READY','MANAGER_1_MIXER_REQ','MANAGER_1_MIXER_STATE','MANAGER_1_MIXER_UNLOADT','MIXER_1_ACK','MIXER_1_BREAKPOINT','MIXER_1_CLOCK','MIXER_1_COUNT','MIXER_1_EXPENSE_0','MIXER_1_EXPENSE_1','MIXER_1_EXPENSE_2','MIXER_1_EXPENSE_3','MIXER_1_EXPENSE_4','MIXER_1_EXPENSE_5','MIXER_1_EXPENSE_6','MIXER_1_F_GO_CLK','MIXER_1_F_GO_Q','MIXER_1_FORBID','MIXER_1_GATE_CLOSED','MIXER_1_GATE_COUNT','MIXER_1_GATE_DR','MIXER_1_GATE_FORBID','MIXER_1_GATE_LOCK','MIXER_1_GATE_MANUAL','MIXER_1_GATE_OPEN','MIXER_1_GATE_OPENED','MIXER_1_GATE_UNLOADING','MIXER_1_GO','MIXER_1_MIXT','MIXER_1_MOTOR_BELL','MIXER_1_MOTOR_ISON','MIXER_1_MOTOR_MANUAL','MIXER_1_MOTOR_OFF','MIXER_1_MOTOR_ON','MIXER_1_MOTOR_POWERED','MIXER_1_NACK','MIXER_1_QRESET','MIXER_1_READY','MIXER_1_REQ','MIXER_1_STATE','MIXER_1_UNLOADT','MOTOR_1_BELL','MOTOR_1_ISON','MOTOR_1_MANUAL','MOTOR_1_OFF','MOTOR_1_ON','MOTOR_1_POWERED','RETARDER_1_DISABLE_1','RETARDER_1_DISABLE_2','RETARDER_1_M','RETARDER_1_MAXM','RETARDER_1_MAXT','RETARDER_2_DISABLE_1','RETARDER_2_DISABLE_2','RETARDER_2_M','RETARDER_2_MAXM','RETARDER_2_MAXT','RETARDER_3_DISABLE_1','RETARDER_3_DISABLE_2','RETARDER_3_M','RETARDER_3_MAXM','RETARDER_3_MAXT','VIBRATOR_1_AUTO','VIBRATOR_1_Q','VIBRATOR_1_WEIGHT_A','VIBRATOR_1_WEIGHT_K','VIBRATOR_1_WEIGHT_M','VIBRATOR_1_WEIGHT_MA','VIBRATOR_1_WEIGHT_RAW','VIBRATOR_1_WEIGHT_SET','VIBRATOR_1_WEIGHT_SHIFT','VIBRATOR_1_WEIGHT_STEP','VIBRATOR_2_AUTO','VIBRATOR_2_Q','VIBRATOR_2_WEIGHT_A','VIBRATOR_2_WEIGHT_K','VIBRATOR_2_WEIGHT_M','VIBRATOR_2_WEIGHT_MA','VIBRATOR_2_WEIGHT_RAW','VIBRATOR_2_WEIGHT_SET','VIBRATOR_2_WEIGHT_SHIFT','VIBRATOR_2_WEIGHT_STEP','VIBRATOR_3_AUTO','VIBRATOR_3_Q','VIBRATOR_3_WEIGHT_A','VIBRATOR_3_WEIGHT_K','VIBRATOR_3_WEIGHT_M','VIBRATOR_3_WEIGHT_MA','VIBRATOR_3_WEIGHT_RAW','VIBRATOR_3_WEIGHT_SET','VIBRATOR_3_WEIGHT_SHIFT','VIBRATOR_3_WEIGHT_STEP','WATER_1_BUSY','WATER_1_CLOSED','WATER_1_DONE','WATER_1_E','WATER_1_ERR','WATER_1_GO','WATER_1_LOCK','WATER_1_M','WATER_1_MAX_FF','WATER_1_MAX_W','WATER_1_MIN_FF','WATER_1_MIN_W','WATER_1_OUT','WATER_1_SP','WATER_M_1_A','WATER_M_1_K','WATER_M_1_M','WATER_M_1_MA','WATER_M_1_RAW','WATER_M_1_SET','WATER_M_1_SHIFT','WATER_M_1_STEP','WPUMP_1_FORCE','WPUMP_1_Q'],defaults=[])
        hw = HW()

При этом выводятся только переменные ввода-вывода. Это удобно для того чтобы autocompleter в VSCode 
выдавал подсказки по именам переменных, например в файле krax.py если писать

.. code-block:: python

    wpump_1 = WPUMP(auto=hw.WATER_OPEN_1, q = hw.WPUMP_ON_1)

после ввода "hw." будет показан список переменных, включая WPUMP_ON_1 и WATER_OPEN_1.

Опции vars
~~~~~~~~~~

- --silent ничего не выводить, только копировать в буфер обмена
- --short для отображения только количества строк
- --format [CSV|PY|VAR_CONFIG] - формат вывода

layout -- Создать настройку модулей ввода-вывода (krax.json+krax.csv)
---------------------------------------------------------------------

Для создания минимальной настройки модулей ввода-вывода проекта можно использовать команду layout:

.. code-block:: bash    

    kraxcli -w . project layout

В режиме диалога нужно будет указать модули ввода-вывода (в порядке установки).
На каждом шаге будет показан список доступных модулей, можно выбрать один и 
будет перед следующим шагом будет показан обновленный список (выбранных модулей 
и их количество).

::

    ? Выберите модуль для добавления: AI-455
    -   AI-455 x 1
    ? Выберите модуль для добавления: (Use arrow keys)
    »   AI-455
        AO-555
        DO-530
        DI-430
        DI-430+
        [Завершить выбор]

Опции layout
~~~~~~~~~~~~

- --dir расположение создаваемых файлов.


init  -- Создать минимальный проект (project.py+krax.py)
--------------------------------------------------------
Минимальный проект для контроллера очень простой, но чтобы автоматизировать создание
такого проекта можно использовать команду init:

.. code-block:: bash    

    kraxcli project init --name <имя_проекта> --version <версия_проекта> [--force]

Эта команда создаст в текущем каталоге файлы project.py и krax.py с минимальным содержимым.

Опции init
~~~~~~~~~~
- --name <имя_проекта> - имя проекта (по умолчанию "NoName")
- --version <версия_проекта> - версия проекта (по умолчанию "v0.1")
- --force - перезаписать существующие файлы.