Управление устройством
======================

Все команды для управления устройством находятся в подкоманде ``dev``. 
В примере предполагается что вы находитесь в рабочем каталоге проекта (это может быть 
временный каталог для акспериментов)

connect - Подключение
---------------------

Устройство можно подключить 2 способами: через serial порт (USB/UART) или по сети (WiFi/Ethernet).
Более надёжный и быстрый способ - через serial порт (особенно для начальной настройки). При этом
есть возможность произвести аппаратную перезагрузку устройства (через DTR сигнал).

Настройка подключения к устройство для текущего рабочего каталога

.. code-block:: bash    
    
    kraxcli -w . dev connect /dev/ttyUSB0

или (при подключении по WiFi устройства)

.. code-block:: bash    
    
    kraxcli -w . dev 192.168.4.1 -p 115200

или (при подключении по LAN устройства)

.. code-block:: bash    
    
    kraxcli -w . dev -p 115200 192.168.2.10 

.. note::
    
    Пароль 115200 используется по умолчанию 

Опции
~~~~~

- --password/-p - пароль для подключения или baudrate для serial устройств (115200 по умолчанию)

serials - Получить информацию об доступных устройствах
------------------------------------------------------

.. code-block:: bash    

    kraxcli dev serials

Выводит список всех доступных serial устройств. 
Если устройство подключено через USB и его нет в списке, то проверьте, что у вас установлены 
драйвера для USB-UART конвертера (CP2104).

reset - Перезагрузить устройство
--------------------------------

Для перезагрузки подключенного устройства используйте команду:

.. code-block:: bash    

    kraxcli -w . dev reset

При разных способах используется разный метод перезагрузки:

- Serial устройства - аппаратная перезагрузка через DTR сигнал
- Сетевые устройства - программная перезагрузка через команду в MicroPython

stop - Остановить выполнение скрипта на устройстве
--------------------------------------------------

Для остановки работы скрипта(программы) на устройстве используйте команду:

.. code-block:: bash    

    kraxcli -w . dev stop

.. note::

    Пока устройство выполняет скрипт (программу), другие команды могут не работать 
    (например repl).

run - Запустить скрипт на устройстве
------------------------------------

Запустить ранее загруженный скрипт на устройстве можно командой:

.. code-block:: bash    

    kraxcli -w . dev run [<имя скрипта>]

Если имя скрипта не указано, то будет запущен скрипт krax.py (если 
он есть на устройстве).

repl - Открыть интерактивную консоль
------------------------------------

Через интерактивную консоль (REPL) можно выполнять все как в обычной REPL MicroPython/Python

.. code-block:: bash    

    kraxcli -w . dev repl

load - Загрузить и выполнить скрипт на устройстве
-------------------------------------------------

Для быстрого тестирования небольших скриптов можно использовать команду загрузки и выполнения:

.. code-block:: bash    

    kraxcli -w . dev load main.py

shell - Выполнить shell среду на устройстве
-------------------------------------------

Shell среда позволяет работать с устройством в интерактивном режиме (похож на cmd/bash),
работать с файлами, настройками и т.д., но к сожалению доступно только в Linux/MacOS.

.. code-block:: bash    

    kraxcli -w . dev shell

info - Получить информацию об устройстве и проекте в контроллере
----------------------------------------------------------------

Чтобы получить информацию об устройстве и проекте, выполните команду:

.. code-block:: bash    

    kraxcli -w . dev info

В случае успешного подключения будет выведена информация об устройстве, прошивке и проекте

::

    SerialDevice @ /dev/ttyUSB0, Type: esp32, Class: SerialDevice
    Firmware: MicroPython v1.26.0-preview.460.g88cb6bc81.dirty on 2025-12-11; PYPLC module (spiram) with ESP32
    CP2104 USB to UART Bridge Controller, Manufacturer: Silicon Labs
    (MAC: 78:e3:6d:74:9b:14)
    Информация о проекте в контроллере:
    name = 'project'
    version = 'v0.0.1'

datetime - Получить/установить текущие дату и время устройства
--------------------------------------------------------------

Для получения текущих даты и времени устройства:

.. code-block:: bash    

    kraxcli -w . dev datetime

для установки текущих даты и времени устройства (используется дата и время хоста):

.. code-block:: bash    

    kraxcli -w . dev datetime --set
